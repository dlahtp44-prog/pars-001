<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <link rel="stylesheet" href="/static/app.css"/>
  <title>ì´ë ¥ì¡°íšŒ</title>

  <style>
    .rolled {
      background:#f5f5f5;
      color:#888;
    }
    .btn-danger {
      background:#c0392b;
      color:#fff;
      border:none;
      padding:4px 8px;
      cursor:pointer;
    }
    .btn-danger:hover {
      background:#a93226;
    }
    .rollback-box input {
      width:120px;
      padding:3px;
    }
  </style>
</head>
<body>
<div class="container">
  <div class="card">
    <h2>ì´ë ¥í˜„í™©</h2>

    <!-- ğŸ” ê²€ìƒ‰ -->
    <form method="get" action="/page/history">
      <div class="grid2">
        <div>
          <label>ë…„(YYYY)</label>
          <input name="year" value="{{year}}" placeholder="ì˜ˆ: 2026"/>
        </div>
        <div>
          <label>ì›”(MM)</label>
          <input name="month" value="{{month}}" placeholder="ì˜ˆ: 1"/>
        </div>
        <div>
          <label>ì¼(DD)</label>
          <input name="day" value="{{day}}" placeholder="ì˜ˆ: 2"/>
        </div>
        <div>
          <label>í‘œì‹œê°œìˆ˜(limit)</label>
          <input name="limit" value="{{limit}}" placeholder="ì˜ˆ: 300"/>
        </div>
      </div>

      <div style="display:flex; gap:8px; margin-top:12px; flex-wrap:wrap;">
        <button class="btn" type="submit">ê²€ìƒ‰</button>

        <a class="btn"
           href="/page/history/excel?year={{year}}&month={{month}}&day={{day}}">
          ì—‘ì…€ ë‹¤ìš´ë¡œë“œ
        </a>

        <a class="btn secondary" href="/">ë©”ì¸</a>
      </div>
    </form>

    <!-- ğŸ“‹ ì´ë ¥ í…Œì´ë¸” -->
    <div style="overflow:auto; margin-top:14px;">
      <table>
        <thead>
          <tr>
            <th class="small">ì‹œê°„</th>
            <th>ìœ í˜•</th>
            <th>ì°½ê³ </th>
            <th>ë¡œì¼€ì´ì…˜</th>
            <th>ì¶œë°œ</th>
            <th>ë„ì°©</th>
            <th>ë¸Œëœë“œ</th>
            <th>í’ˆë²ˆ</th>
            <th>í’ˆëª…</th>
            <th>LOT</th>
            <th>ê·œê²©</th>
            <th>ìˆ˜ëŸ‰</th>
            <th>ë¹„ê³ </th>
            <th>ì‘ì—…ì</th>
            <th>ë¡¤ë°±</th>
          </tr>
        </thead>
        <tbody>
        {% for r in rows %}
          <tr class="{% if r.rolled_back %}rolled{% endif %}">
            <td class="small">{{r.created_at}}</td>
            <td>
              {{r.type}}
              {% if r.type == "ë¡¤ë°±" %}
                ğŸ”
              {% endif %}
            </td>
            <td>{{r.warehouse}}</td>
            <td>{{r.location}}</td>
            <td>{{r.from_location}}</td>
            <td>{{r.to_location}}</td>
            <td>{{r.brand}}</td>
            <td>{{r.item_code}}</td>
            <td>{{r.item_name}}</td>
            <td>{{r.lot}}</td>
            <td>{{r.spec}}</td>
            <td style="text-align:right;">{{r.qty}}</td>
            <td>
              {{r.note}}
              {% if r.rolled_back %}
                <div class="small">
                  â¤· {{r.rollback_note}}
                </div>
              {% endif %}
            </td>
            <td>{{r.operator}}</td>

            <!-- ğŸ”¥ ë¡¤ë°± ë²„íŠ¼ -->
            <td>
              {% if r.can_rollback %}
              <form method="post"
                    action="/api/rollback"
                    class="rollback-box"
                    onsubmit="return confirm('ì´ ì´ë ¥ì„ ë¡¤ë°±í•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">
                <input type="hidden" name="history_id" value="{{r.id}}">
                <input type="text" name="note" placeholder="ì‚¬ìœ ">
                <button class="btn-danger" type="submit">ë¡¤ë°±</button>
              </form>
              {% else %}
                <span class="small">-</span>
              {% endif %}
            </td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    </div>

    <p class="small" style="margin-top:10px;">
      â€» ì…ê³  / ì¶œê³  / ì´ë™ ì´ë ¥ë§Œ ë¡¤ë°± ê°€ëŠ¥í•˜ë©°, ë¡¤ë°± í›„ ì¬ê³ ëŠ” ìë™ ì›ë³µë©ë‹ˆë‹¤.
    </p>
  </div>
</div>
</body>
</html>
