<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <link rel="stylesheet" href="/static/app.css"/>
  <title>ì œí’ˆ ì„ íƒ</title>
</head>
<body>
<div class="container">
  <div class="card">
    <h2>ì œí’ˆ ì„ íƒ</h2>
    <p class="small">ì¶œë°œ ë¡œì¼€ì´ì…˜: <b>{{ from_location }}</b></p>

    {% if rows|length == 0 %}
      <p>í•´ë‹¹ ë¡œì¼€ì´ì…˜ì— ì¬ê³ ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
      <p class="small"><a href="/m/move/from">â† ì¶œë°œ ë¡œì¼€ì´ì…˜ ë‹¤ì‹œ</a></p>
    {% else %}

      <form method="post" action="/m/move/select/submit" id="moveForm">
        <!-- ğŸ”¹ ì„œë²„ í•„ìˆ˜ -->
        <input type="hidden" name="from_location" value="{{ from_location }}">

        <table>
          <thead>
            <tr>
              <th>ì„ íƒ</th>
              <th>ë¸Œëœë“œ</th>
              <th>í’ˆë²ˆ</th>
              <th>LOT</th>
              <th>ê·œê²©</th>
              <th style="text-align:right">ì¬ê³ </th>
            </tr>
          </thead>
          <tbody>
            {% for r in rows %}
            <tr>
              <td>
                <!-- âœ… inventory_id ì „ì†¡ -->
                <input
                  type="radio"
                  name="inventory_id"
                  required
                  data-qty="{{ r.qty }}"
                  value="{{ r.id }}"
                >
              </td>
              <td>{{ r.brand }}</td>
              <td>{{ r.item_code }}</td>
              <td>{{ r.lot }}</td>
              <td>{{ r.spec }}</td>
              <td style="text-align:right">{{ r.qty }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>

        <div style="margin-top:12px;">
          <p class="small">
            ì„ íƒ ì¬ê³ : <b id="availQty">-</b>
          </p>

          <!-- âœ… ì„œë²„ê°€ ê¸°ëŒ€í•˜ëŠ” í•„ë“œëª… -->
          <label>ì´ë™ ìˆ˜ëŸ‰</label>
          <input
            name="qty_raw"
            id="qtyInput"
            type="text"
            inputmode="decimal"
            pattern="[0-9]*[.,]?[0-9]*"
            placeholder="ì˜ˆ: 12.5"
            autocomplete="off"
            required
          >

          <label>ì‘ì—…ì</label>
          <input
            name="operator"
            type="text"
            placeholder="ì˜ˆ: í™ê¸¸ë™"
            autocomplete="off"
            required
          >

          <label>ë¹„ê³ </label>
          <input
            name="note"
            type="text"
            placeholder="ì„ íƒ"
            autocomplete="off"
          >

          <button type="submit">
            ë‹¤ìŒ: ë„ì°© ë¡œì¼€ì´ì…˜ ìŠ¤ìº”
          </button>
        </div>
      </form>

      <p class="small">
        <a href="/m/move/from">â† ì¶œë°œ ë¡œì¼€ì´ì…˜ ë‹¤ì‹œ</a>
      </p>

      <script>
      (function(){
        const avail = document.getElementById("availQty");
        const qtyInput = document.getElementById("qtyInput");
        const form = document.getElementById("moveForm");

        let available = 0;

        document.querySelectorAll("input[name='inventory_id']").forEach(r=>{
          r.addEventListener("change", ()=>{
            available = parseFloat(r.dataset.qty || "0");
            avail.textContent = available;
          });
        });

        form.addEventListener("submit", (e)=>{
          const q = parseFloat(qtyInput.value.replace(",", ".") || "0");

          if(!available){
            alert("ì œí’ˆì„ ì„ íƒí•˜ì„¸ìš”.");
            e.preventDefault();
            return;
          }

          if(isNaN(q) || q <= 0){
            alert("ì´ë™ ìˆ˜ëŸ‰ì„ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥í•˜ì„¸ìš”.");
            e.preventDefault();
            return;
          }

          if(q > available){
            alert("ìˆ˜ëŸ‰ì´ ì¬ê³ ë¥¼ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤.");
            e.preventDefault();
          }
        });
      })();
      </script>

    {% endif %}
  </div>
</div>
</body>
</html>
